name : Deploy Dist
on : [push, workflow_dispatch]
jobs : 
    test :
        runs-on : ubuntu-latest
        steps : 
            - name : Get Code
              uses : actions/checkout@v2
            #   run : |
            #     echo "cloning the repo"
            #     echo "${{toJson(github)}}"
            #     git clone https://github.com/${{github.repository}}.git

            - name : Install Node
              uses : actions/setup-node@v2
              with : 
                node-version : '20'

            - name : check node version
              run : |
                    node -v
                    npm -v

            - name : Install Dependencies
              run : |
                    echo "Installing dependencies"
                    npm ci
                    echo "Dependencies installed"

            - name : Checking Tests
              run : |
                    echo "Running tests"
                    npm test
                    echo "Tests completed"

    deploy :
        needs : test
        runs-on : ubuntu-latest
        steps : 
            - name : Get Code
              uses : actions/checkout@v2

            - name : Install Node
              uses : actions/setup-node@v2
              with : 
                    node-version : '20'

            - name : cache 
              uses : actions/cache@v2
              with : 
                    path : ~/.npm
                    key : ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                    restore-keys : |
                        ${{ runner.os }}-node-        
            - name : Install Dependencies
              run : |
                    echo "Installing dependencies"
                    npm ci
                    echo "Dependencies installed"
            - name : Build
              run : npm run build

            - name : Deploy
              run : echo "Deployed successfully"
        